#!/usr/bin/env ruby
$LOAD_PATH.unshift File.expand_path("../lib", __dir__)
require "zohomail_client"
require "dotenv"

begin
  Dotenv.load
  ZohomailClient.configure do |config|
    config.client_id = ENV["ZOHOMAIL_CLIENT_ID"]
    config.client_secret = ENV["ZOHOMAIL_CLIENT_SECRET"]
    config.refresh_token = ENV["ZOHOMAIL_REFRESH_TOKEN"]
    config.account_id = ENV["ZOHOMAIL_ACCOUNT_ID"]
  end

  client = ZohomailClient.client

  puts "Fetching folders..."
  response = client.list_folders

  if response["data"] && response["data"].is_a?(Array)
    puts "Folders:"
    response["data"].each do |folder|
      puts "ID: #{folder["folderId"]} - Name: #{folder["folderName"]}"
    end
  else
    $stderr.puts "No folders found or unexpected format: #{response}"
  end
rescue ZohomailClient::Error => e
  $stderr.puts "Error: #{e.message}"
  exit 1
end
